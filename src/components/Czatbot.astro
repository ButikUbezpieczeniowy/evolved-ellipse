// Kod JS wewnÄ…trz <script> w pliku src/components/Czatbot.astro

    const czatInput = document.getElementById('czat-input');
    const czatHistoria = document.getElementById('czat-historia');
    
    // Funkcja do dodawania wiadomoÅ›ci do interfejsu
    function addMessage(sender, text) {
        const messageElement = document.createElement('div');
        messageElement.className = `p-2 rounded-lg text-sm max-w-[80%] ${
            sender === 'user' ? 'ml-auto bg-blue-100 text-right' : 'mr-auto bg-gray-100 text-left'
        }`;
        messageElement.textContent = text;
        czatHistoria.appendChild(messageElement);
        czatHistoria.scrollTop = czatHistoria.scrollHeight; // PrzewiÅ„ na dÃ³Å‚
    }

    // Funkcja obsÅ‚ugujÄ…ca wysyÅ‚kÄ™ wiadomoÅ›ci do Vercel Function
    async function sendMessage() {
        const message = czatInput.value.trim();
        if (message === "") return;

        addMessage('user', message);
        czatInput.value = '';
        czatInput.disabled = true; // Zablokuj input na czas oczekiwania
        addMessage('system', 'ğŸ¤– PiszÄ™ odpowiedÅº...'); // Placeholder odpowiedzi

        // 1. Tworzenie historii wiadomoÅ›ci (dla kontekstu konwersacji)
        // Musisz uwzglÄ™dniÄ‡ poprzednie wiadomoÅ›ci z interfejsu (lub state managera)
        // Dla uproszczenia w tym przykÅ‚adzie wysyÅ‚amy tylko nowÄ… wiadomoÅ›Ä‡:
        const messageHistory = [{ role: "user", content: message }]; 

        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ messageHistory }),
            });

            const data = await response.json();
            
            // Usuwamy placeholder i dodajemy faktycznÄ… odpowiedÅº
            czatHistoria.lastChild.remove(); 
            
            if (response.ok) {
                addMessage('system', data.response);
            } else {
                addMessage('system', `âŒ BÅ‚Ä…d: ${data.error || 'Nieznany bÅ‚Ä…d AI.'}`);
            }

        } catch (error) {
            console.error("BÅ‚Ä…d wysyÅ‚ki wiadomoÅ›ci:", error);
            czatHistoria.lastChild.remove();
            addMessage('system', 'âŒ BÅ‚Ä…d poÅ‚Ä…czenia sieciowego. SprawdÅº konsolÄ™.');
        } finally {
            czatInput.disabled = false;
            czatInput.focus();
        }
    }

    // Dodanie event listenera do inputu (po naciÅ›niÄ™ciu Enter)
    czatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    // Utrzymujemy dotychczasowÄ… logikÄ™ otwierania/zamykania UI:
    // (Kod otwierania/zamykania z poprzedniej wiadomoÅ›ci pozostaje bez zmian)